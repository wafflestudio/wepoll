<% content_for :scripts do -%>
  <script type="text/javascript">
    Raphael.fn.pieChart = function (cx, cy, r, values, labels, stroke) {
      var paper = this,
      rad = Math.PI / 180,
      chart = this.set();
      function sector(cx, cy, r, startAngle, endAngle, params) {
        var x1 = cx + r * Math.cos(-startAngle * rad),
        x2 = cx + r * Math.cos(-endAngle * rad),
        y1 = cy + r * Math.sin(-startAngle * rad),
        y2 = cy + r * Math.sin(-endAngle * rad);
        return paper.path(["M", cx, cy, "L", x1, y1, "A", r, r, 0, +(endAngle - startAngle > 180), 0, x2, y2, "z"]).attr(params);
      }
      var angle = 0,
      total = 0,
      start = 0,
      process = function (j) {
        var value = values[j],
        angleplus = 360 * value / total,
        popangle = angle + (angleplus / 2),
        color = Raphael.hsb(start, .75, 1),
        ms = 500,
        delta = 30,
        bcolor = Raphael.hsb(start, 1, 1),
        p = sector(cx, cy, r, angle, angle + angleplus, {fill: "90-" + bcolor + "-" + color, stroke: stroke, "stroke-width": 3}),
        txt = paper.text(cx + (r - 35) * Math.cos(-popangle * rad), cy + (r - 25) * Math.sin(-popangle * rad), labels[j]).attr({fill: "#000", stroke: "none", opacity: 0, "font-size": 10});
        p.mouseover(function () {
          p.stop().animate({transform: "s1.1 1.1 " + cx + " " + cy}, ms, "elastic");
          txt.stop().animate({opacity: 1}, ms, "elastic");
        }).mouseout(function () {
          p.stop().animate({transform: ""}, ms, "elastic");
          txt.stop().animate({opacity: 0}, ms);
        });
        angle += angleplus;
        chart.push(p);
        chart.push(txt);
        start += .1;
      };
      for (var i = 0, ii = values.length; i < ii; i++) {
        total += values[i];
      }
      for (i = 0; i < ii; i++) {
        process(i);
      }
      return chart;
    };


    $(document).ready(function() {
      $(".bar-graph").simpleBarGraph({
        width:176, 
        height:5
      });

      //draw pie chart
      var p1_bill_counts = [<%= @p1_bill_counts.join(",") %>];
      var p1_bill_categories = $.parseJSON('<%=raw @p1_bill_categories.to_json %>');

      var p2_bill_counts = [<%= @p2_bill_counts.join(",")%>];
      var p2_bill_categories = $.parseJSON('<%=raw @p2_bill_categories %>');
      Raphael("p1-bill-graph", 176, 176).pieChart(176/2,176/2,80, p1_bill_counts, p1_bill_categories, "#fff");
      Raphael("p2-bill-graph", 176, 176).pieChart(176/2,176/2,80, p2_bill_counts, p2_bill_categories, "#fff");

    });
  </script>
<% end -%>
<h1><%=@district %></h1>

<div id="name-cards" class="grid_12 alpha omega">
  <div class="grid_6 alpha name-card">
    <div class="grid_3 alpha tweet">
      last tweet of <%= @p1.tweet_name%>
    </div>
    <div class="grid_3 omega">
      <%= image_tag @p1.profile_photo.url(:square100) %>
    </div>
    <div class="clear"></div>
    <div class="grid_3 alpha">
      <div id="p1-good-link" class="bar-graph"
        data-color="green"
        data-total="-1"
        data-ref="#p1-bad-link"
        data-float="right"
        data-value="50">
      </div>

      <div id="p1-bad-link" class="bar-graph"
        data-color="red"
        data-total="-1"
        data-ref="#p1-good-link"
        data-float="right"
        data-value="100">
      </div>
    </div>
    <div class="grid_3 omega">
      <a href="#">링크등록</a>
    </div>
  </div>

  <div class="grid_6 omega name-card">
    <div class="grid_3 alpha">
      <%= image_tag @p2.profile_photo.url(:square100) %>
    </div>
    <div class="grid_3 alpha tweet omega">
      last tweet of <%=@p2.tweet_name%>
    </div>
    <div class="clear"></div>
    <div class="grid_3 omega">
      <a href="#">링크등록</a>
    </div>
    <div class="grid_3 alpha">
      <div id="p2-good-link" class="bar-graph"
        data-color="green"
        data-total="-1"
        data-ref="#p2-bad-link"
        data-value="80">
      </div>
      <div id="p2-bad-link" class="bar-graph"
        data-color="red"
        data-total="-1"
        data-ref="#p2-good-link"
        data-value="200">
      </div>
    </div>
  </div>
</div>

<div class="grid_12 alpha omega">
  <div class="grid_2 alpha tabs">
    <%= link_to 'BEST 영상','#', :class => 'tab' %>
    <%= link_to 'BEST 기사','#', :class => 'tab' %>
    <%= link_to '국회활동','#', :class => 'tab' %>
    <%= link_to '신상','#', :class => 'tab' %>
    <%= link_to '공약','#', :class => 'tab' %>
  </div>

  <div class="grid_8">
    <!-- 대표 링크들 -->
    <div class="grid_8 alpha omega tab-section" id="most-links">
      <div class="grid_4 alpha">
        <h4>칭찬</h4>
        <%= render :partial => "/timeline_entries/entry", :locals => {:link => @p1.most_good_link} %>
        <h4>지적</h4>
        <%= render :partial => "/timeline_entries/entry", :locals => {:link => @p1.most_bad_link} %>
      </div>

      <div class="grid_4 omega">
        <h4>칭찬</h4>
        <%= render :partial => "/timeline_entries/entry", :locals => {:link => @p2.most_good_link} %>
        <h4>지적</h4>
        <%= render :partial => "/timeline_entries/entry", :locals => {:link => @p2.most_bad_link} %>
      </div>
    </div>

    <!-- 의정활동-->
    <div class="grid_8 alpha omega tab-section" id="bill-activity">
      <div class="grid_8 alpha omega row">
        <div class="grid_3 alpha">?/??</div>
        <div class="grid_2">공약이행</div>
        <div class="grid_3 omega">?/??</div>
      </div>

      <div class="grid_8 alpha omega row">
        <div class="grid_3 alpha">
          <%= render :partial => "initiate_bills_summary", 
            :locals => {:politician => @p1, :div_id => "p1-bill-graph"} %>
        </div>
        <div class="grid_2">대표발의법안</div>
        <div class="grid_3 omega">
          <%= render :partial => "initiate_bills_summary", 
            :locals => {:politician => @p2, :div_id => "p2-bill-graph"} %>
        </div>
      </div>

      <div class="grid_8 alpha omega row">
        <div class="grid_3 alpha">&nbsp;</div>
        <div class="grid_2">국회인맥</div>
        <div class="grid_3 omega">&nbsp;</div>
      </div>

      <div class="grid_8 alpha omega row">
        <div class="grid_3 alpha">&nbsp;</div>
        <div class="grid_2">본회의출석률</div>
        <div class="grid_3 omega">&nbsp;</div>
      </div>
    </div>
  </div>

  <div class="grid_2 omega">
  </div>
</div>
